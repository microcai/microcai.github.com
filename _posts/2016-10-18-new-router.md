---
layout: post
title: 新的路由器
tags: [network, ERX]
---

上文说到，我使用无线网桥衔接了2个家庭，组成了一个局域网，共享了宽带。

但是，局域网和局域网还是太过开放，网桥又是一段不怎么可靠的网线。因此2个局域网最好能隔离开来，隔离广播域，又能通过IP地址直连。
经过研究发现家里宽带还可以多拨。虽然多拨并不叠加带宽，但是可以多获得一个公网ip。有多一个 ip 对 NAT 来说，也是可以极大的提升网络性能的。

于是找啊找，找发现了一个利器 “ubnt EdgeRouter X”。 不过 350 块钱的价格，但是却提供了思科路由器一样的功能。BGP OSPF RIP 动态路由协议应有尽有。什么？家用用不到动态路由协议？ 呵呵，马上你就知道了，我确实需要它。 提供5个千兆网口，更重要的是，五个独立的网口。也就是在操作系统里是 eth0 eth1 eth2 wth3 eth4 5块网卡。这就可以进行比较高级的玩法了。可以任意组合 N WAN + M LAN ，而不像普通路由器那样，只有一个 WAN 一个 LAN （ 或者少数几个也不过支持双WAN）。 基本上就是一台软路由的玩法了。而且一般软路由都没有5个网卡哦！

电信自带光猫有2个LAN口，这就是给多拨准备的啊！

于是作出了这样的规划

<img src="/images/all-network-struct.svg" width="100%" />

ERX路由器和猫之间连了2条网线。直接双拨。

路由器一个 LAN 连 原来的 wifi 路由器，另一个 LAN 连网桥。

把原来的路由器，都使用 WAN 口 （注意，是 WAN口哦！） 连到 ERX。无线网桥相当于是网线，所以是姐姐家的路由器 WAN口连到了 ERX 上。

同时，在两台wifi路由器上关闭 NAT然后打开动态路由 ！！！ 这个很重要！！！ LAN 口的 DHCP 打开， WAN 口使用 DHCP 自动获取。

各自的路由器就通过自己的 DHCP 管理自己网段内的设备了。 然后因为开启了 动态路由协议，所以 ERX 能顺利的自动找到2个子网的路由。

然后2家的局域网就网段隔离了，但是有路由器在，ip 是可以直通的，局域网内主机互访没有问题，没有经过NAT。只有通过外网的时候才被 ERX NAT 一次。而且经过了负载均衡。

然后意外的发现，上行可以叠加。






