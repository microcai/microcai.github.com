---
layout: post
title: soho路由器是单臂路由器
---

用 VLAN 划分局域网后，2个局域网之间就不能通信了。如果要让这2个网络能互访，就需要路由器。如果VLAN只是用来做端口隔离，那它本身就毫无意义，买多台独立的口少点的交换机更便宜。VLAN所以那么有用，完全是因为 vlan trunk 端口的存在。使得以太网在交换机上变成了一种隧道。一个二层的隧道。于是只有一个接口的路由器在这种隧道的帮助下能访问被 VLAN 隔离的网络。这种路由器，就是单臂路由器。单臂路由器虽然性能不好，但是能以极低的成本解决网间互联问题。如果网间没有大量的数据交互，单臂路由器就非常合适。当然如果网间有大量数据交换那还是上个3层交换机吧。

单臂路由器的性能受限的原因是，多个VLAN之间的总数据交换大小为 trunk 端口的 1/2。VLAN1到 VLAN2 的单向数据，就占用 trunk 端口的双向流量。因此总交换容量就只有端口速率的 1/2。对大部分网络来说，这是双向50M（百兆以太网） 或者双向500M(千兆以太网)。

尽管性能不佳，但是成本低廉，因此应用非常广泛。常见的soho路由器就是单臂路由器和vlan交换机的结合体。

soho路由器的有线部分，实际上就是个单臂路由器。路由器上的 WAN 口和 LAN口只是分属2个（固定的）vlan。交换芯片有一个隐藏端口直连CPU。这个直连端口就是个 trunk 端口。

这就是为何百兆路由器并不能跑满百兆宽带。因为单臂路由器就是上下行总和100M， 而且百兆宽带是下行 100M。如果还有上行数据，那么无论如何都无法跑满下行带宽了。

更换千兆路由器其实有时候并不能解决这个问题，因为...

许多廉价的千兆路由器，居然也仅仅是千兆交换芯片。trunk 口直连 CPU 的线路依然是百兆的。因此不是换千兆路由器就行的。你看到的千兆连接只是假象。这样还不如维持原来的路由器，只通过采购额外的千兆交换机来提升内网速度成本来的更低。而且独立的交换机其背板带宽是充足的。而路由器上自带的交换芯片。。通常背板带宽是严重不足的。你能想象内网两台正在对拷数据，居然会影响第三台电脑上外网速度的吗？ 这就是路由器自带的交换芯片背板带宽不足的表现。

